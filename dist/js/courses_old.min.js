document.addEventListener('DOMContentLoaded',function(){initializeCategoryDropdowns();initializeFilterButtons();initializeSearch();initializeCheckboxFilters()});function initializeCategoryDropdowns(){const categoryItems=document.querySelectorAll('.category-item');categoryItems.forEach(item=>{const header=item.querySelector('.category-item-header');header.addEventListener('click',()=>{item.classList.toggle('active');categoryItems.forEach(otherItem=>{if(otherItem!==item&&otherItem.classList.contains('active')){otherItem.classList.remove('active')}})})})}
function initializeFilterButtons(){const filterButtons=document.querySelectorAll('.filter-btn');const courseCards=document.querySelectorAll('.course-card');const sidebarFilterOptions=document.querySelectorAll('.filter-option');function filterCourses(filter){courseCards.forEach(card=>{const categories=card.dataset.category.split(' ');if(filter==='all'||categories.includes(filter)){card.style.display='block'}else{card.style.display='none'}})}
filterButtons.forEach(button=>{button.addEventListener('click',()=>{filterButtons.forEach(btn=>btn.classList.remove('active'));button.classList.add('active');sidebarFilterOptions.forEach(option=>{if(option.dataset.filter===button.dataset.filter){option.classList.add('active')}else{option.classList.remove('active')}});filterCourses(button.dataset.filter);updateActiveFilters(button.dataset.filter,button.textContent)})});sidebarFilterOptions.forEach(option=>{option.addEventListener('click',()=>{sidebarFilterOptions.forEach(opt=>opt.classList.remove('active'));option.classList.add('active');filterButtons.forEach(btn=>{if(btn.dataset.filter===option.dataset.filter){btn.classList.add('active')}else{btn.classList.remove('active')}});filterCourses(option.dataset.filter);const filterName=option.querySelector('.filter-name').textContent.trim();updateActiveFilters(option.dataset.filter,filterName)})})}
function initializeSearch(){const searchInput=document.getElementById('search-input');const sidebarSearchInput=document.getElementById('sidebar-search-input');const searchBtn=document.getElementById('search-btn');const sidebarSearchBtn=document.getElementById('sidebar-search-btn');const courseCards=document.querySelectorAll('.course-card');function performSearch(searchTerm){searchTerm=searchTerm.toLowerCase();courseCards.forEach(card=>{const title=card.querySelector('h3').textContent.toLowerCase();const description=card.querySelector('p').textContent.toLowerCase();if(title.includes(searchTerm)||description.includes(searchTerm)){card.style.display='block'}else{card.style.display='none'}});if(searchTerm){updateActiveFilters('search',`جستجو: ${searchTerm}`)}}
searchBtn.addEventListener('click',()=>{performSearch(searchInput.value)});sidebarSearchBtn.addEventListener('click',()=>{searchInput.value=sidebarSearchInput.value;performSearch(sidebarSearchInput.value)});searchInput.addEventListener('keypress',(e)=>{if(e.key==='Enter'){performSearch(searchInput.value)}});sidebarSearchInput.addEventListener('keypress',(e)=>{if(e.key==='Enter'){searchInput.value=sidebarSearchInput.value;performSearch(sidebarSearchInput.value)}})}
function initializeCheckboxFilters(){const levelCheckboxes=document.querySelectorAll('.level-checkbox');const priceCheckboxes=document.querySelectorAll('.price-checkbox');const courseCards=document.querySelectorAll('.course-card');function applyFilters(){const selectedLevels=Array.from(levelCheckboxes).filter(checkbox=>checkbox.checked).map(checkbox=>checkbox.id.replace('level-',''));const selectedPrices=Array.from(priceCheckboxes).filter(checkbox=>checkbox.checked).map(checkbox=>checkbox.id.replace('price-',''));courseCards.forEach(card=>{let showCard=!0;if(selectedLevels.length>0){const cardLevel=card.querySelector('.course-meta-item:nth-child(3) span').textContent.toLowerCase();const matchesLevel=selectedLevels.some(level=>{if(level==='beginner'&&cardLevel.includes('مبتدی'))return!0;if(level==='intermediate'&&cardLevel.includes('متوسط'))return!0;if(level==='advanced'&&cardLevel.includes('پیشرفته'))return!0;return!1});if(!matchesLevel){showCard=!1}}
if(selectedPrices.length>0&&showCard){const isFree=card.dataset.category.includes('free');const matchesPrice=(isFree&&selectedPrices.includes('free'))||(!isFree&&selectedPrices.includes('paid'));if(!matchesPrice){showCard=!1}}
card.style.display=showCard?'block':'none'});updateActiveFiltersFromCheckboxes()}
levelCheckboxes.forEach(checkbox=>{checkbox.addEventListener('change',applyFilters)});priceCheckboxes.forEach(checkbox=>{checkbox.addEventListener('change',applyFilters)})}
function updateActiveFilters(filterType,filterText){const activeFiltersContainer=document.getElementById('active-filters');const existingFilters=activeFiltersContainer.querySelectorAll(`.filter-tag[data-type="${filterType}"]`);existingFilters.forEach(filter=>filter.remove());if(filterType==='all'){activeFiltersContainer.innerHTML='';return}
const filterTag=document.createElement('div');filterTag.className='filter-tag';filterTag.dataset.type=filterType;filterTag.innerHTML=`
        ${filterText}
        <span class="remove-tag" onclick="removeFilter(this)">×</span>
    `;activeFiltersContainer.appendChild(filterTag)}
function updateActiveFiltersFromCheckboxes(){const activeFiltersContainer=document.getElementById('active-filters');const existingLevelFilters=activeFiltersContainer.querySelectorAll('.filter-tag[data-type^="level-"]');existingLevelFilters.forEach(filter=>filter.remove());const existingPriceFilters=activeFiltersContainer.querySelectorAll('.filter-tag[data-type^="price-"]');existingPriceFilters.forEach(filter=>filter.remove());const levelCheckboxes=document.querySelectorAll('.level-checkbox:checked');levelCheckboxes.forEach(checkbox=>{const levelLabel=checkbox.nextElementSibling.textContent;const filterTag=document.createElement('div');filterTag.className='filter-tag';filterTag.dataset.type=`level-${checkbox.id}`;filterTag.innerHTML=`
            سطح: ${levelLabel}
            <span class="remove-tag" onclick="removeFilter(this, '${checkbox.id}')">×</span>
        `;activeFiltersContainer.appendChild(filterTag)});const priceCheckboxes=document.querySelectorAll('.price-checkbox:checked');priceCheckboxes.forEach(checkbox=>{const priceLabel=checkbox.nextElementSibling.textContent;const filterTag=document.createElement('div');filterTag.className='filter-tag';filterTag.dataset.type=`price-${checkbox.id}`;filterTag.innerHTML=`
            قیمت: ${priceLabel}
            <span class="remove-tag" onclick="removeFilter(this, '${checkbox.id}')">×</span>
        `;activeFiltersContainer.appendChild(filterTag)})}
function removeFilter(element,checkboxId){const filterTag=element.parentElement;const filterType=filterTag.dataset.type;filterTag.remove();if(checkboxId){const checkbox=document.getElementById(checkboxId);if(checkbox){checkbox.checked=!1;const event=new Event('change');checkbox.dispatchEvent(event)}
return}
if(filterType==='search'){document.getElementById('search-input').value='';document.getElementById('sidebar-search-input').value=''}
if(!filterType.startsWith('level-')&&!filterType.startsWith('price-')){document.querySelectorAll('.filter-btn').forEach(btn=>{btn.classList.remove('active');if(btn.dataset.filter==='all'){btn.classList.add('active')}});document.querySelectorAll('.filter-option').forEach(option=>{option.classList.remove('active');if(option.dataset.filter==='all'){option.classList.add('active')}});document.querySelectorAll('.course-card').forEach(card=>{card.style.display='block'})}}