document.addEventListener('DOMContentLoaded',function(){initMatrixAnimation();initCategoryDropdowns();initCodeHighlighting();initTableOfContents();initImageLightbox();initPreloader()});function initCodeHighlighting(){if(typeof Prism!=='undefined'){Prism.highlightAll()}}
function initTableOfContents(){const articleBody=document.querySelector('.article-body');const tocContainer=document.querySelector('.table-of-contents');if(!articleBody||!tocContainer)return;const headings=articleBody.querySelectorAll('h2, h3');if(headings.length>0){const tocList=document.createElement('ul');tocList.className='toc-list';headings.forEach((heading,index)=>{if(!heading.id){heading.id=`heading-${index}`}
const listItem=document.createElement('li');listItem.className=`toc-item toc-${heading.tagName.toLowerCase()}`;const link=document.createElement('a');link.href=`#${heading.id}`;link.textContent=heading.textContent;listItem.appendChild(link);tocList.appendChild(listItem);link.addEventListener('click',function(e){e.preventDefault();document.querySelector(this.getAttribute('href')).scrollIntoView({behavior:'smooth'})})});tocContainer.appendChild(tocList)}else{tocContainer.style.display='none'}}
function initImageLightbox(){const articleImages=document.querySelectorAll('.article-body img');const lightbox=document.getElementById('image-lightbox');if(!lightbox)return;const lightboxImg=lightbox.querySelector('.lightbox-image');const closeLightbox=lightbox.querySelector('.close-lightbox');articleImages.forEach(img=>{img.style.cursor='pointer';img.addEventListener('click',function(){lightboxImg.src=this.src;lightboxImg.alt=this.alt;lightbox.classList.add('show');document.body.style.overflow='hidden'})});if(closeLightbox){closeLightbox.addEventListener('click',function(){lightbox.classList.remove('show');document.body.style.overflow='auto'})}
lightbox.addEventListener('click',function(e){if(e.target===lightbox){lightbox.classList.remove('show');document.body.style.overflow='auto'}});document.addEventListener('keydown',function(e){if(e.key==='Escape'&&lightbox.classList.contains('show')){lightbox.classList.remove('show');document.body.style.overflow='auto'}})}
function initCategoryDropdowns(){const categoryItems=document.querySelectorAll('.category-item');categoryItems.forEach(item=>{item.classList.remove('active')});categoryItems.forEach(item=>{const header=item.querySelector('.category-item-header');const dropdown=item.querySelector('.category-dropdown');header.addEventListener('click',function(e){e.stopPropagation();const isActive=item.classList.contains('active');categoryItems.forEach(otherItem=>{otherItem.classList.remove('active')});if(!isActive){item.classList.add('active')}})});document.addEventListener('click',function(){categoryItems.forEach(item=>{item.classList.remove('active')})})}
document.addEventListener('DOMContentLoaded',function(){initCategoryDropdowns()});document.addEventListener('DOMContentLoaded',function(){const hamburger=document.querySelector('.hamburger');const navLinks=document.querySelector('.nav-links');hamburger.addEventListener('click',function(){navLinks.classList.toggle('active');hamburger.classList.toggle('active')})});document.querySelectorAll('.article-body pre').forEach(pre=>{const button=document.createElement('button');button.className='copy-btn';button.textContent='Copy';button.addEventListener('click',()=>{const code=pre.querySelector('code');navigator.clipboard.writeText(code.textContent);button.textContent='Copied!';setTimeout(()=>button.textContent='Copy',2000)});pre.appendChild(button)});function copyArticleLink(){const linkInput=document.getElementById('article-link');linkInput.select();document.execCommand('copy');alert('لینک مقاله کپی شد!')}
function shareToInstagram(){alert('برای اشتراک در اینستاگرام، لینک مقاله را در استوری یا پست خود قرار دهید.');return!1}
function shareToYouTube(){alert('برای اشتراک در یوتیوب، لینک مقاله را در توضیحات ویدیو قرار دهید.');return!1}
document.addEventListener('DOMContentLoaded',function(){const articleUrl=encodeURIComponent(window.location.href);const articleTitle=encodeURIComponent(document.title);document.querySelectorAll('[href*="ARTICLE_URL"], [href*="ARTICLE_TITLE"]').forEach(link=>{link.href=link.href.replace('ARTICLE_URL',articleUrl).replace('ARTICLE_TITLE',articleTitle)});document.getElementById('article-link').value=window.location.href})